# 3. Tipologie di VPN

Le VPN possono essere classificate in diverse categorie in base all'architettura, al modello di connessione e al protocollo utilizzato. Comprendere le differenze è fondamentale per scegliere la soluzione più adatta alle proprie esigenze.

## 3.1 VPN Remote Access (Client-to-Site)

La **VPN Remote Access**, anche chiamata **Client-to-Site** o **Host-to-Network**, permette a singoli utenti di connettersi a una rete privata da remoto attraverso Internet.

### Architettura

```
┌──────────────┐                           ┌────────────────────────────┐
│ Remote User  │                           │    Corporate Network       │
│  (Client)    │    Internet (tunnel)      │                            │
│              ├──────────────────────────→│  ┌──────────────┐          │
│ [VPN Client] │      Encrypted            │  │ VPN Gateway  │          │
└──────────────┘                           │  └───────┬──────┘          │
                                           │          │                 │
                                           │    ┌─────┴────────┐        │
                                           │    │ File Server  │        │
                                           │    │ Email Server │        │
                                           │    │ Database     │        │
                                           │    └──────────────┘        │
                                           └────────────────────────────┘
```

### Caratteristiche

**Componenti principali**
- Client VPN installato sul dispositivo utente (laptop, smartphone, tablet)
- VPN Gateway/Concentrator nella rete aziendale
- Autenticazione tramite credenziali utente (spesso con MFA)
- Assegnazione dinamica di IP interno all'utente

**Funzionamento**
1. Utente avvia il client VPN
2. Client si autentica presso il gateway
3. Tunnel crittografato viene stabilito
4. Utente riceve un IP della rete interna
5. Tutto il traffico (o parte) passa attraverso il tunnel
6. Gateway instrada il traffico verso le risorse interne

### Scenari d'uso

#### 1. Smart Working / Telelavoro
```
Dipendente da casa → VPN → Rete aziendale → Accesso a:
  - File server aziendali
  - Applicazioni interne
  - Desktop remoto
  - Database aziendali
```

**Vantaggi**
- Accesso sicuro da qualsiasi luogo
- Esperienza utente simile all'essere in ufficio
- Nessuna esposizione diretta dei servizi su Internet

#### 2. Accesso da dispositivi mobili
- Smartphone e tablet aziendali
- Accesso a email aziendale in sicurezza
- Sincronizzazione documenti
- VPN always-on per dispositivi mobile (iOS, Android)

#### 3. Collaboratori esterni
- Consulenti e contractor temporanei
- Partner commerciali
- Accesso granulare basato su ruolo
- Facile attivazione/disattivazione account

### Configurazione tipica

**Sul client (esempio OpenVPN)**
```bash
client
dev tun
proto udp
remote vpn.company.com 1194
resolv-retry infinite
nobind
persist-key
persist-tun
ca ca.crt
cert user-alice.crt
key user-alice.key
remote-cert-tls server
cipher AES-256-GCM
verb 3
```

**Sul gateway**
- Pool di indirizzi IP per client connessi
- Regole di routing verso rete interna
- Policies di accesso basate su utente/gruppo
- Timeout di idle session

### Vantaggi
✅ Flessibilità per utenti in movimento  
✅ Configurazione centralizzata  
✅ Scalabile per molti utenti  
✅ Controllo granulare degli accessi  
✅ Audit trail delle connessioni

### Svantaggi
❌ Richiede installazione software sui client  
❌ Performance dipende dalla connessione Internet dell'utente  
❌ Possibile sovraccarico del gateway con molti utenti  
❌ Split-tunneling può creare rischi di sicurezza  
❌ Gestione certificati/credenziali per ogni utente

## 3.2 VPN Site-to-Site

La **VPN Site-to-Site**, anche chiamata **LAN-to-LAN** o **Router-to-Router**, connette intere reti locali tra loro attraverso Internet, creando una rete unificata.

### Architettura

```
┌─────────────────────────┐                      ┌─────────────────────────┐
│   Sede Principale       │                      │    Filiale Remota       │
│   LAN: 192.168.1.0/24   │                      │   LAN: 192.168.2.0/24   │
│                         │                      │                         │
│  ┌──────────────┐       │                      │       ┌──────────────┐  │
│  │ VPN Gateway  │       │      Internet        │       │ VPN Gateway  │  │
│  │  (Router)    ├───────┼──────────────────────┼───────┤  (Router)    │  │
│  └──────┬───────┘       │   Encrypted Tunnel   │       └──────┬───────┘  │
│         │               │                      │              │          │
│    ┌────┴─────┐         │                      │        ┌─────┴────┐     │
│    │ Servers  │         │                      │        │ Clients  │     │
│    │ Database │         │                      │        │ Printers │     │
│    └──────────┘         │                      │        └──────────┘     │
└─────────────────────────┘                      └─────────────────────────┘

Tutto il traffico tra le due LAN passa automaticamente attraverso il tunnel VPN
```

### Caratteristiche

**Componenti principali**
- Gateway VPN su ogni sito (router, firewall, appliance dedicata)
- Tunnel permanente sempre attivo (o on-demand)
- Routing trasparente tra le reti
- Nessun client VPN richiesto sui dispositivi degli utenti

**Funzionamento**
1. Gateway configurati con parametri del tunnel
2. Tunnel stabilito automaticamente all'avvio
3. Traffico destinato alla rete remota viene automaticamente instradato nel tunnel
4. Crittografia e decriptazione trasparenti per gli utenti
5. Routing dinamico (opzionale) per topologie complesse

### Tipi di VPN Site-to-Site

#### 1. Intranet VPN
Connette sedi della stessa organizzazione
```
Sede A (Milano) ←→ Sede B (Roma) ←→ Sede C (Napoli)
       ↓
Rete aziendale unificata
```

#### 2. Extranet VPN
Connette reti di organizzazioni diverse (partner, fornitori)
```
Azienda A ←→ Partner B
    ↓            ↓
  Risorse   Accesso limitato
  interne   solo a risorse
            condivise
```

### Scenari d'uso

#### 1. Connessione tra filiali
```
Sede Centrale (Milano)
     ├─ VPN Site-to-Site → Filiale Roma
     ├─ VPN Site-to-Site → Filiale Torino
     └─ VPN Site-to-Site → Filiale Napoli

Tutte le sedi possono accedere a:
- File server centrale
- Database aziendale unificato
- Sistema ERP comune
- Stampanti e risorse di ogni sede
```

**Vantaggi specifici**
- Infrastruttura IT centralizzata
- Backup centralizzato di tutti i dati
- Amministrazione unificata
- VoIP tra sedi senza costi

#### 2. Disaster Recovery
```
Datacenter Primario ←→ Datacenter Backup
         ↓                    ↓
  Servizi in produzione   Replica dati in tempo reale
                          Pronto per failover
```

#### 3. Cloud Hybrid
```
Datacenter On-Premise ←→ Cloud Provider (AWS/Azure/GCP)
         ↓                         ↓
   Applicazioni legacy      Applicazioni cloud-native
   Database principali      Compute elastico
```

### Topologie Site-to-Site

#### Hub-and-Spoke (Star)
```
        Sede B
           ↑
           |
Sede A ← HUB → Sede C
           |
           ↓
        Sede D
```
- Una sede centrale (hub) connessa a tutte le filiali (spoke)
- Traffico tra spoke passa sempre per l'hub
- Semplice da gestire, ma hub è single point of failure

#### Full Mesh
```
Sede A ←→ Sede B
  ↕    ✗    ↕
Sede C ←→ Sede D
```
- Ogni sede connessa direttamente a tutte le altre
- Bassa latenza tra qualsiasi coppia di sedi
- Complesso da configurare (n*(n-1)/2 tunnel)
- Scalabilità limitata

#### Partial Mesh
```
Sede A ←→ Sede B
  ↕         ↕
Sede C ← Sede D
```
- Compromesso tra hub-spoke e full mesh
- Tunnel diretti solo dove necessario (traffico frequente)
- Bilanciamento complessità/performance

### Configurazione tipica

**IPsec Site-to-Site (esempio Cisco)**
```
crypto isakmp policy 10
 encryption aes 256
 hash sha256
 authentication pre-share
 group 14
 lifetime 86400

crypto isakmp key MySecretKey address 203.0.113.10

crypto ipsec transform-set MYSET esp-aes 256 esp-sha256-hmac

crypto map MYMAP 10 ipsec-isakmp
 set peer 203.0.113.10
 set transform-set MYSET
 match address VPN-TRAFFIC

interface GigabitEthernet0/0
 crypto map MYMAP

ip access-list extended VPN-TRAFFIC
 permit ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255
```

**OpenVPN Site-to-Site**
```bash
# Site A
dev tun
proto udp
port 1194
server 10.8.0.0 255.255.255.0
route 192.168.2.0 255.255.255.0  # Rete remota
push "route 192.168.1.0 255.255.255.0"  # Rete locale
```

### Vantaggi
✅ Trasparente per gli utenti finali  
✅ Tunnel sempre disponibile  
✅ Throughput elevato (hardware dedicato)  
✅ Scalabile per grandi reti  
✅ Nessun software da installare sui client  
✅ Ideale per traffico continuo tra sedi

### Svantaggi
❌ Costo iniziale hardware più elevato  
❌ Configurazione complessa per topologie mesh  
❌ Richiede IP pubblico statico (o DDNS)  
❌ Manutenzione più impegnativa  
❌ Problemi di routing in caso di overlap di subnet

## 3.3 VPN Host-to-Host

La **VPN Host-to-Host** connette due singoli dispositivi creando un tunnel punto-punto crittografato. È meno comune delle altre tipologie ma utile in scenari specifici.

### Architettura

```
┌─────────────┐            Tunnel VPN           ┌─────────────┐
│   Host A    │ ←────────────────────────────→  │   Host B    │
│             │         Internet                │             │
│ 10.0.0.1    │                                 │ 10.0.0.2    │
└─────────────┘                                 └─────────────┘
```

### Scenari d'uso

#### 1. Comunicazione sicura tra server
```
Database Server ←→ Application Server
     (Cloud)            (On-premise)
```
- Backup server-to-server
- Replicazione database
- Trasferimento sicuro di file sensibili

#### 2. Debug e amministrazione remota
```
Admin Workstation ←→ Server in Produzione
    (tecnico)          (datacenter remoto)
```
- SSH tunneling attraverso VPN
- RDP sicuro
- Accesso diretto per troubleshooting

#### 3. Connessioni temporanee ad-hoc
- Collaborazione peer-to-peer sicura
- Trasferimento file crittografato
- Gaming con latenza ridotta

### Configurazione esempio (WireGuard)

**Host A**
```ini
[Interface]
PrivateKey = <private_key_A>
Address = 10.0.0.1/24
ListenPort = 51820

[Peer]
PublicKey = <public_key_B>
Endpoint = host-b.example.com:51820
AllowedIPs = 10.0.0.2/32
PersistentKeepalive = 25
```

**Host B**
```ini
[Interface]
PrivateKey = <private_key_B>
Address = 10.0.0.2/24
ListenPort = 51820

[Peer]
PublicKey = <public_key_A>
Endpoint = host-a.example.com:51820
AllowedIPs = 10.0.0.1/32
PersistentKeepalive = 25
```

### Vantaggi
✅ Minima latenza (connessione diretta)  
✅ Semplice da configurare  
✅ Overhead ridotto  
✅ Nessuna infrastruttura intermedia necessaria

### Svantaggi
❌ Non scala per molti host  
❌ Configurazione manuale per ogni coppia  
❌ Meno flessibile di altre soluzioni

## 3.4 VPN SSL/TLS vs IPsec

Due approcci fondamentalmente diversi per implementare VPN. La scelta tra SSL/TLS e IPsec dipende da requisiti specifici, infrastruttura esistente e casi d'uso.

### VPN SSL/TLS

Operano a livello applicativo (Layer 7), utilizzando il protocollo SSL/TLS per crittografare il traffico.

#### Caratteristiche
- **Protocollo**: SSL/TLS (porta TCP 443 generalmente)
- **Layer OSI**: Livello 4-7 (applicativo)
- **Autenticazione**: Certificati X.509, username/password
- **Accesso**: Può essere clientless (browser) o con client dedicato

#### Esempi di implementazioni
- **OpenVPN**: soluzione open-source più popolare
- **Cisco AnyConnect SSL**: enterprise solution
- **Fortinet SSL-VPN**: integrata nei firewall FortiGate
- **Pulse Secure**: (ex-Juniper SSL VPN)

#### Modalità di accesso

**1. Clientless (Portal-based)**
```
User → Browser (HTTPS) → VPN Gateway → Intranet
```
- Accesso via web browser senza installare software
- Limitato ad applicazioni web (HTTP/HTTPS)
- Ideale per accessi occasionali

**2. Tunnel Mode (Full VPN)**
```
User → VPN Client → Tunnel SSL/TLS → Gateway → Tutte le risorse
```
- Client leggero da installare
- Accesso completo a tutte le risorse
- Simile a essere nella LAN aziendale

#### Configurazione OpenVPN (esempio)
```bash
# Server
port 443
proto tcp
dev tun
ca ca.crt
cert server.crt
key server.key
dh dh2048.pem
server 10.8.0.0 255.255.255.0
cipher AES-256-GCM
tls-version-min 1.2
```

#### Vantaggi SSL/TLS VPN
✅ Traversa facilmente NAT e firewall (porta 443)  
✅ Nessun problema con proxy aziendali  
✅ Supporto clientless per accessi occasionali  
✅ Configurazione più semplice di IPsec  
✅ Granularità di accesso a livello applicativo  
✅ Cross-platform (Windows, Mac, Linux, mobile)  
✅ Ideale per remote access

#### Svantaggi SSL/TLS VPN
❌ Performance inferiori a IPsec per throughput elevato  
❌ Overhead maggiore (layer applicativo)  
❌ Meno adatto per site-to-site con traffico intenso  
❌ Alcuni protocolli non-TCP possono avere problemi

### VPN IPsec

Opera a livello network (Layer 3), crittografando direttamente i pacchetti IP.

#### Caratteristiche
- **Protocollo**: ESP (IP protocol 50), AH (IP protocol 51), IKE (UDP 500/4500)
- **Layer OSI**: Livello 3 (network)
- **Autenticazione**: Pre-shared keys, certificati, RSA signatures
- **Modalità**: Transport mode, Tunnel mode

#### Componenti IPsec
1. **IKE (Internet Key Exchange)**: negozia parametri e scambia chiavi
   - IKEv1: standard originale
   - IKEv2: moderno, più efficiente, supporto mobility
2. **ESP (Encapsulating Security Payload)**: crittografa e autentica
3. **AH (Authentication Header)**: solo autenticazione (raro oggi)

#### Modalità IPsec

**Transport Mode**
```
[IP Header][ESP Header][TCP/UDP][Data][ESP Trailer]
                   └── Crittografato ──┘
```
- Cripta solo il payload, header IP originale visibile
- Utilizzato in host-to-host
- Overhead minore

**Tunnel Mode**
```
[Nuovo IP Header][ESP Header][IP Header Originale][TCP][Data][ESP Trailer]
                          └──────── Crittografato ──────────┘
```
- Cripta l'intero pacchetto IP originale
- Nuovo header IP per routing attraverso Internet
- Utilizzato in site-to-site

#### Configurazione strongSwan (Linux IPsec)
```bash
# /etc/ipsec.conf
conn myVPN
    left=%defaultroute
    leftsubnet=192.168.1.0/24
    right=203.0.113.10
    rightsubnet=192.168.2.0/24
    ike=aes256-sha256-modp2048!
    esp=aes256-sha256!
    keyexchange=ikev2
    auto=start
```

#### Vantaggi IPsec VPN
✅ Performance elevate (opera a layer 3)  
✅ Throughput maggiore per grandi volumi di traffico  
✅ Supporto nativo nei sistemi operativi  
✅ Standard aperto ben consolidato  
✅ Ideale per site-to-site  
✅ Può proteggere qualsiasi protocollo IP  
✅ Hardware acceleration disponibile (AES-NI)

#### Svantaggi IPsec VPN
❌ Difficoltà a traversare NAT (richiede NAT-T)  
❌ Bloccato da alcuni firewall aziendali  
❌ Configurazione complessa  
❌ Problemi di compatibilità tra vendor diversi  
❌ Richiede supporto a livello kernel/driver

### Confronto diretto

| Criterio | SSL/TLS VPN | IPsec VPN |
|----------|-------------|-----------|
| **Layer OSI** | 4-7 (Applicativo) | 3 (Network) |
| **Porta** | TCP 443 (configurabile) | UDP 500, 4500, ESP(50) |
| **Traversamento NAT/Firewall** | ✅ Eccellente | ⚠️ Richiede NAT-T |
| **Performance** | ⚠️ Buone | ✅ Ottime |
| **Throughput** | Media-Alta | Alta-Molto Alta |
| **Latenza** | Leggermente superiore | Inferiore |
| **Configurazione** | ✅ Semplice | ❌ Complessa |
| **Client required** | Opzionale | Sì (o nativo OS) |
| **Remote Access** | ✅ Ideale | ✅ Buono |
| **Site-to-Site** | ⚠️ Possibile | ✅ Ideale |
| **Granularità accesso** | ✅ Per applicazione | ⚠️ Per rete/host |
| **Supporto mobile** | ✅ Eccellente | ✅ Buono (IKEv2) |
| **Standard** | OpenVPN (de-facto) | RFC ufficiali |
| **Compatibilità** | ✅ Universale | ⚠️ Vendor-specific |

### Quando usare SSL/TLS VPN
- Remote access per utenti mobili
- Accesso attraverso reti con firewall restrittivi
- Utenti con dispositivi eterogenei
- Necessità di accesso clientless
- Controllo granulare delle applicazioni

### Quando usare IPsec VPN
- Connessioni site-to-site con traffico elevato
- Performance critiche
- Integrazione con infrastruttura esistente IPsec
- Ambienti omogenei (stesso vendor)
- Protezione di qualsiasi protocollo IP

### Soluzione Ibrida
Molte organizzazioni implementano entrambe:
```
Remote Users (mobile) → SSL VPN → Corporate Network
                                         ↕
Branch Offices → IPsec Site-to-Site → Main Office
```

---

**Capitolo precedente**: [02. Concetti Fondamentali](02.Concetti_Fondamentali.md)  
**Prossimo capitolo**: [04. Protocolli VPN](04.Protocolli_VPN.md)
