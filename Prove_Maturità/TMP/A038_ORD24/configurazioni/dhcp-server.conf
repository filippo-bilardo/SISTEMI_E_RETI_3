# ========================================
# CONFIGURAZIONE ISC DHCP SERVER
# Prova A038_ORD24
# Server: 10.50.20.11
# Data: 30 Gennaio 2026
# ========================================

# Configurazioni globali
default-lease-time 28800;  # 8 ore
max-lease-time 43200;      # 12 ore
authoritative;
ddns-update-style none;
log-facility local7;

# Opzioni DNS globali
option domain-name "azienda.local";
option domain-name-servers 10.50.20.10;

# ========================================
# SUBNET LAN1 - UTENTI UFFICI
# Network: 10.50.10.0/24
# Gateway: 10.50.10.1
# ========================================

subnet 10.50.10.0 netmask 255.255.255.0 {
    # Range IP dinamici (150 indirizzi disponibili)
    range 10.50.10.50 10.50.10.200;
    
    # Gateway di default (VLAN 10 SVI)
    option routers 10.50.10.1;
    
    # DNS Server
    option domain-name-servers 10.50.20.10, 8.8.8.8;
    
    # Domain name
    option domain-name "azienda.local";
    
    # NTP Server
    option ntp-servers 10.50.0.1;
    
    # Lease time specifico per utenti
    default-lease-time 28800;   # 8 ore
    max-lease-time 86400;       # 24 ore
    
    # Reservation per stampanti e dispositivi fissi
    
    # Stampante Piano 1
    host stampante-piano1 {
        hardware ethernet 00:11:22:33:44:01;
        fixed-address 10.50.10.10;
    }
    
    # Stampante Piano 2
    host stampante-piano2 {
        hardware ethernet 00:11:22:33:44:02;
        fixed-address 10.50.10.11;
    }
    
    # Access Point WiFi Uffici
    host ap-wifi-uffici-1 {
        hardware ethernet 00:AA:BB:CC:DD:01;
        fixed-address 10.50.10.20;
    }
    
    host ap-wifi-uffici-2 {
        hardware ethernet 00:AA:BB:CC:DD:02;
        fixed-address 10.50.10.21;
    }
    
    # Telefoni IP VoIP
    host voip-reception {
        hardware ethernet 00:1A:2B:3C:4D:01;
        fixed-address 10.50.10.30;
        option tftp-server-name "10.50.20.13";
    }
    
    host voip-ufficio1 {
        hardware ethernet 00:1A:2B:3C:4D:02;
        fixed-address 10.50.10.31;
        option tftp-server-name "10.50.20.13";
    }
}

# ========================================
# SUBNET LAN3 - AMMINISTRAZIONE IT
# Network: 10.50.30.0/24
# Gateway: 10.50.30.1
# ========================================

subnet 10.50.30.0 netmask 255.255.255.0 {
    # Range IP dinamici (100 indirizzi)
    range 10.50.30.50 10.50.30.150;
    
    # Gateway di default (VLAN 30 SVI)
    option routers 10.50.30.1;
    
    # DNS Server
    option domain-name-servers 10.50.20.10, 8.8.8.8;
    
    # Domain name
    option domain-name "azienda.local";
    
    # NTP Server
    option ntp-servers 10.50.0.1;
    
    # Lease time più lungo per postazioni admin
    default-lease-time 43200;   # 12 ore
    max-lease-time 86400;       # 24 ore
    
    # Reservation per dispositivi amministrativi
    
    # Workstation Admin Principale
    host admin-ws-01 {
        hardware ethernet 00:50:56:AA:BB:01;
        fixed-address 10.50.30.10;
    }
    
    # Laptop Admin IT
    host admin-laptop-01 {
        hardware ethernet 00:50:56:AA:BB:02;
        fixed-address 10.50.30.11;
    }
    
    # Console di Management
    host mgmt-console {
        hardware ethernet 00:50:56:AA:BB:03;
        fixed-address 10.50.30.12;
    }
}

# ========================================
# SUBNET LAN2 - SERVER (SOLO DOCUMENTAZIONE)
# Network: 10.50.20.0/24
# NOTA: Server hanno IP statici, non usano DHCP
# ========================================

# subnet 10.50.20.0 netmask 255.255.255.0 {
#     # Questa subnet NON usa DHCP
#     # Tutti i server hanno configurazione IP statica
# }

# Assegnazioni statiche Server LAN2:
# 10.50.20.10 - DNS Server
# 10.50.20.11 - DHCP Server (questo server)
# 10.50.20.12 - File Server / Syslog
# 10.50.20.13 - Database Server
# 10.50.20.14 - Application Server
# 10.50.20.15 - VPN Server

# ========================================
# SUBNET DMZ (SOLO DOCUMENTAZIONE)
# Network: 10.50.100.0/26
# NOTA: Server DMZ hanno IP statici
# ========================================

# Assegnazioni statiche Server DMZ:
# 10.50.100.10 - Web Server
# 10.50.100.11 - Mail Server
# 10.50.100.12 - FTP Server (se presente)

# ========================================
# SUBNET VPN (GESTITA DA OPENVPN)
# Network: 10.50.200.0/26
# NOTA: Pool gestito da OpenVPN server
# ========================================

# Pool OpenVPN: 10.50.200.10 - 10.50.200.60

# ========================================
# LOGGING E MONITORING
# ========================================

# Log delle assegnazioni DHCP
log-facility local7;

# Logging dettagliato (decommentare se necessario debug)
# log-threshold 0;

# ========================================
# FAILOVER CONFIGURATION (OPZIONALE)
# Per alta disponibilità con secondo DHCP server
# ========================================

# failover peer "dhcp-failover" {
#     primary;
#     address 10.50.20.11;
#     port 647;
#     peer address 10.50.20.16;
#     peer port 647;
#     max-response-delay 60;
#     max-unacked-updates 10;
#     load balance max seconds 3;
#     mclt 3600;
#     split 128;
# }

# ========================================
# COMANDI DI GESTIONE
# ========================================

# Avvio servizio:
# systemctl start isc-dhcp-server
# systemctl enable isc-dhcp-server

# Verifica configurazione:
# dhcpd -t -cf /etc/dhcp/dhcpd.conf

# Visualizza lease attivi:
# dhcp-lease-list
# cat /var/lib/dhcp/dhcpd.leases

# Log in tempo reale:
# tail -f /var/log/syslog | grep dhcpd

# Statistiche:
# journalctl -u isc-dhcp-server

# ========================================
# FILE DI CONFIGURAZIONE DHCP SERVER
# Percorso: /etc/dhcp/dhcpd.conf
# ========================================
